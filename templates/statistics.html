{% extends "main_template.html" %}

{% block title %} Activity Log {% endblock title %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css"/>
{% endblock css %}

{% block content %}
    <div id="row">
        <div class="col-md-6">
            <canvas id="patients_chart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="prescriptions_chart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="visits_chart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="visit_length_chart"></canvas>
        </div>
        <div class="cold-md-12">
            <table id="patients" class="table" width="100%">
                <thead>
                <tr>
                    <th>#</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Visits</th>
                    <th>Average Visit Length</th>
                    <th>Admitted?</th>
                    <th>Last Admitted</th>
                </tr>
                </thead>
                <tbody>

                {% for p in patients %}
                    <tr>
                        <td>{{ p.pk }}</td>
                        <td>{{ p.first_name }}</td>
                        <td>{{ p.last_name }}</td>
                        <td>{{ p.visits }}</td>
                        <td>{{ p.get_average_visit_length_str }}</td>
                        <td>{% if p.is_admitted  %}Yes{% else %}No{% endif %}</td>
                        <td>{% if p.last_admit_date  %}{{ p.last_admit_date }}{% else %}Never{% endif %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
    </div>
{% endblock content %}

{% block scripts %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.0.1/Chart.bundle.min.js"></script>
    <script type="text/javascript">
    new Chart($("#prescriptions_chart"), {
        type: 'bar',
        data: {
            labels: {{ popular_scripts_names_json | safe }},
            datasets: [
                {
                    label: "Popular Prescriptions",
                    backgroundColor: "rgba(255,99,132,0.2)",
                    borderColor: "rgba(255,99,132,1)",
                    borderWidth: 1,
                    hoverBackgroundColor: "rgba(255,99,132,0.4)",
                    hoverBorderColor: "rgba(255,99,132,1)",
                    data: {{ popular_scripts_values_json }}
                }
            ]
        },
        options: {}
    });

    new Chart($("#patients_chart"), {
        type: 'bar',
        data: {
            labels: ['Admitted Patients', 'Discharged Patients', 'Total Patients'],
            datasets: [
                {
                    label: "Patients",
                    backgroundColor: "rgba(255,99,132,0.2)",
                    borderColor: "rgba(255,99,132,1)",
                    borderWidth: 1,
                    hoverBackgroundColor: "rgba(255,99,132,0.4)",
                    hoverBorderColor: "rgba(255,99,132,1)",
                    data: [{{ num_patients_admitted }}, {{ num_patients_discharged }}, {{ number_paitents }}]
                }
            ]
        },
        options: {}
    });

    new Chart($("#visits_chart"), {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: "Number of Visits",
                    backgroundColor: "rgba(255,99,132,0.2)",
                    borderColor: "rgba(255,99,132,1)",
                    borderWidth: 1,
                    hoverBackgroundColor: "rgba(255,99,132,0.4)",
                    hoverBorderColor: "rgba(255,99,132,1)",
                    data: {{ average_visits | safe}}
                }
            ]
        },
        options: {}
    });

    new Chart($("#visit_length_chart"), {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: "Visit Length",
                    backgroundColor: "rgba(255,99,132,0.2)",
                    borderColor: "rgba(255,99,132,1)",
                    borderWidth: 1,
                    hoverBackgroundColor: "rgba(255,99,132,0.4)",
                    hoverBorderColor: "rgba(255,99,132,1)",
                    data: {{ average_visit_length | safe}}
                }
            ]
        },
        options: {}
    });


    $(document).ready(function () {
        $('#patients').DataTable({
            "order": [[1, "desc"]],
            "iDisplayLength": 25
        });
    });
    </script>
{% endblock scripts %}